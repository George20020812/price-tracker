# Facebook 價格追蹤器 (Facebook Price Tracker)

這是一個用於追蹤 Facebook Marketplace 商品價格的應用程式，由一個 Python/Flask 後端和一個功能豐富的瀏覽器插件前端組成。

## 主要功能

-   **手動多品項追蹤：** 透過瀏覽器插件，您可以手動輸入商品名稱和價格，並將多個商品添加到一個列表中，然後一次性追蹤這些商品所屬的貼文。
-   **元素選擇器模式 (Marketplace 專用)：** 此功能**僅適用於 Facebook Marketplace 的商品詳情頁面**。您可以手動點擊頁面元素來擷取商品名稱和價格的 CSS 選擇器。儲存這些選擇器後，您可以快速載入商品資訊到手動輸入欄位中。如果不在正確的頁面使用此功能，系統將會提供友善的提示。
-   **追蹤選取商品：** 點擊此按鈕，將會嘗試使用儲存的選擇器從當前頁面載入商品資訊，並將其添加到追蹤列表後立即觸發追蹤。
-   **商品追蹤列表：** 在插件中查看所有已追蹤商品的列表，包含名稱和當前價格。時間顯示現在**只顯示月份和日期**。
-   **價格趨勢圖：** 點擊列表中的商品，可查看其歷史價格的折線圖，一目瞭然價格變化。
-   **商品詳情：** 顯示商品名稱、當前價格、原始連結。原始連結現在會**精簡顯示 (移除 `https://` 或 `http://`，並縮短)**。
-   **商品管理：** 提供刪除商品功能，移除不再追蹤的項目。
-   **後端 API：** 提供穩定的 API 服務，處理資料儲存與查詢。

## 技術棧

-   **後端:** Python, Flask, Flask-SQLAlchemy, Flask-CORS
-   **前端:** 瀏覽器插件 (HTML, CSS, JavaScript, Chart.js)
-   **資料庫:** SQLite

---

## 如何安裝與使用

本專案包含一個後端服務和一個功能豐富的瀏覽器插件前端，兩者需要同時運行。

### 步驟 1：設定後端服務

1.  **複製專案**
    ```bash
    git clone <your-repository-url>
    cd fb-price-tracker/backend
    ```

2.  **建立並啟用虛擬環境**
    -   Windows:
        ```bash
        python -m venv venv
        .\venv\Scripts\activate
        ```
    -   macOS/Linux:
        ```bash
        python3 -m venv venv
        source venv/bin/activate
        ```

3.  **安裝依賴套件**
    > 建議先建立 `requirements.txt` 檔案 (`pip freeze > requirements.txt`)
    ```bash
    pip install -r requirements.txt
    ```
    或者手動安裝主要套件：
    ```bash
    pip install Flask Flask-SQLAlchemy Flask-CORS
    ```

### 步驟 2：載入瀏覽器插件

您需要將 `extension` 資料夾載入到您的瀏覽器 (以 Chrome/Edge 為例)：

1.  打開瀏覽器，在網址列輸入 `chrome://extensions` 並按下 Enter。
2.  **打開右上角的「開發人員模式」開關**。
3.  點擊左上角的「**載入未封裝項目**」按鈕。
4.  在跳出的檔案選擇視窗中，選擇 `fb-price-tracker/extension` 這個資料夾，然後按下「選取資料夾」。
5.  載入成功後，您應該會在瀏覽器右上角看到插件的圖示。


### 步驟 4：啟動後端服務

1.  使用您之前建立的批次檔來啟動後端：
    ```bash
    E:\priceRecord\fb-price-tracker\start_backend.bat
    ```
2.  確保後端服務在 `http://127.0.0.1:5001` 上成功運行，不要關閉這個終端機視窗。

### 步驟 5：使用瀏覽器插件

**介面視覺優化：** 插件介面已全面升級，提供更現代、美觀且一致的使用者體驗。內容會自動適應不同螢幕大小，並處理文字溢出。

1.  **追蹤貼文中的多個商品：**
    *   瀏覽到您想要追蹤商品的 Facebook 貼文或頁面。
    *   點擊瀏覽器右上角的 **FB Price Tracker** 圖示。
    *   插件會自動顯示當前頁面的 URL (只顯示部分內容，完整 URL 可透過工具提示查看)。
    *   **手動輸入商品資訊**：在「商品名稱」和「價格」輸入框中手動輸入商品資訊。
    *   **使用元素選擇器 (Marketplace 專用)**：
        *   如果您在 Facebook Marketplace 頁面，可以點擊「選擇名稱」或「選擇價格」按鈕。
        *   此時，插件會進入「選擇模式」，您的滑鼠游標會變成十字形。
        *   將滑鼠移動到 Facebook 頁面上的商品名稱或價格上，您會看到元素被藍色框高亮顯示。
        *   點擊您想要擷取的元素。插件會自動獲取該元素的 CSS 選擇器，並顯示在輸入框中。
        *   您可以點擊「儲存選擇器」按鈕來儲存這些選擇器，以便下次快速載入。點擊「清除」按鈕可以移除儲存的選擇器。
        *   點擊「載入選取商品資訊」按鈕，插件會嘗試使用儲存的選擇器從當前頁面提取商品名稱和價格，並填充到手動輸入欄位中。
        *   點擊「**追蹤選取商品**」按鈕，將會嘗試使用儲存的選擇器從當前頁面載入商品資訊，並將其添加到追蹤列表後立即觸發追蹤。
    *   點擊「**添加**」按鈕將商品添加到下方的列表中。您可以重複此步驟添加多個商品。
    *   確認所有要追蹤的商品都已添加到列表後，點擊「**追蹤此貼文中的所有商品**」按鈕。插件會將這些商品連同當前頁面 URL 一起發送到後端儲存。

2.  **查看追蹤列表與詳情：**
    *   在插件彈出視窗中，點擊右上角的「列表」圖示 (三條橫線)。
    *   您將看到所有已追蹤商品的列表。時間顯示會根據紀錄時間間隔自動調整詳細程度。
    *   點擊列表中的任一商品，即可進入其詳情頁面，查看當前價格、原始連結和歷史價格趨勢圖。

3.  **刪除商品：**
    *   在商品詳情頁面，點擊「刪除此商品」按鈕即可移除該商品的追蹤紀錄。

**重要提示：** 插件的元素選擇器模式僅適用於 Facebook Marketplace 頁面。Facebook 的網頁結構時常變動，如果儲存的選擇器失效，您可能需要重新選取並儲存新的選擇器。

---

## API 端點

-   `POST /api/items`: 新增一個或多個商品進行追蹤 (支援單一貼文多品項)。
-   `GET /api/items`: 獲取所有追蹤中的商品列表。
-   `GET /api/items/<id>/history`: 獲取特定商品的歷史價格資料。
-   `DELETE /api/items/<id>`: 刪除特定商品及其所有追蹤紀錄。

---

## 圖表範例資料 (Chart Sample Data)

以下是一組可用於測試圖表顯示的假資料，您可以將其用於開發或測試目的：

```json
[
  {
    "price": 100.00,
    "timestamp": "2024-01-01T10:00:00Z"
  },
  {
    "price": 95.50,
    "timestamp": "2024-01-05T14:30:00Z"
  },
  {
    "price": 102.20,
    "timestamp": "2024-01-10T09:15:00Z"
  },
  {
    "price": 98.00,
    "timestamp": "2024-01-15T11:00:00Z"
  },
  {
    "price": 105.75,
    "timestamp": "2024-01-20T16:45:00Z"
  },
  {
    "price": 103.00,
    "timestamp": "2024-01-25T08:00:00Z"
  },
  {
    "price": 110.50,
    "timestamp": "2024-02-01T12:00:00Z"
  },
  {
    "price": 108.20,
    "timestamp": "2024-02-05T10:00:00Z"
  },
  {
    "price": 115.00,
    "timestamp": "2024-02-10T14:00:00Z"
  },
  {
    "price": 112.50,
    "timestamp": "2024-02-15T09:00:00Z"
  }
]
```
